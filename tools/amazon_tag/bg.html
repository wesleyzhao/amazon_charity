<!DOCTYPE HTML>
<html>
  <head>
    <script type="text/javascript" src="bg_js.js"></script>
    <script>
      var asin = "";
      chrome.extension.onConnect.addListener(function(port){
      var tab = port.sender.tab;
      
      port.onMessage.addListener(function(info){
         asin = info.asin;
         if (asin){
           var popup_file = "amz_pop.html";
         }
         else{ var popup_file = "popup.html";}
         chrome.tabs.getSelected(null, function(tab){
            chrome.browserAction.setPopup({tabId: tab.id, "popup": popup_file});
          });
         
      });
      
      });
      /*
      chrome.browserAction.onClicked.addListener(function(tab){
      //this is not called with the browserAction is a popup woops
      chrome.browserAction.setPopup({"popup":"popup.html"});
      chrome.tabs.executeScript(null, {file: "content_script.js"});
      });
      */
    </script>
  </head>
</html>
